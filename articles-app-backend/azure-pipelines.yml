trigger:
  - develop

pr:
  - '*'

pool:
  vmImage: 'ubuntu-latest'

variables:
  JAVA_HOME: '/usr/lib/jvm/java-17-openjdk-amd64'

stages:
  - stage: Build
    jobs:
      - job: Build
        steps:
          - script: |
              echo "##vso[task.setvariable variable=JAVA_HOME]$JAVA_HOME"
            displayName: 'Set JAVA_HOME variable'

          - script: 'gradle clean build'
            displayName: 'Build with Gradle'

          - task: PublishBuildArtifacts@1
            inputs:
              pathtoPublish: '$(Build.SourcesDirectory)/build/libs'
              artifactName: 'drop'
              publishLocation: 'Container'

  - stage: Deploy
    jobs:
      - job: Deploy
        steps:
          - script: |
              echo "##vso[task.setvariable variable=JAVA_HOME]$JAVA_HOME"
            displayName: 'Set JAVA_HOME variable'

          - task: AzureRmWebAppDeployment@4
            inputs:
              ConnectionType: 'AzureRM'
              appType: 'webAppLinux'
              WebAppName: 'RedaLahrache'
              packageForLinux: '$(Pipeline.Workspace)/drop/*.jar'
              RuntimeStack: 'TOMCAT|8.5-jre11'
